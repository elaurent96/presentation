<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Présentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary: #0d6efd;
            --dark: #212529;
        }

        body,
        html {
            height: 100%;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
        }

        .navbar {
            z-index: 1030;
        }

        .editor-panel {
            height: calc(100vh - 56px);
            overflow-y: auto;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
        }

        .preview-panel {
            height: calc(100vh - 56px);
            background: #000;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .slide-item {
            cursor: pointer;
            border-left: 4px solid transparent;
            transition: all 0.2s;
            padding: 10px;
        }

        .slide-item:hover {
            background: #e9ecef;
            border-left-color: var(--primary);
        }

        .slide-item.active-slide {
            background: #e7f1ff;
            border-left-color: var(--primary);
            font-weight: 600;
        }

        #preview-container {
            flex-grow: 1;
            background: #fff;
            position: relative;
            overflow: hidden;
        }

        input[type="color"] {
            padding: 0;
            height: 38px;
            cursor: pointer;
            width: 100%;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .btn-float-del {
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }

        .slide-item:hover .btn-float-del {
            opacity: 1;
        }

        .accordion-button:focus {
            box-shadow: none;
            border-color: rgba(0, 0, 0, .125);
        }

        .accordion-button:not(.collapsed) {
            background-color: #e7f1ff;
            color: var(--primary);
        }

        #projectFolderName {
            font-weight: bold;
            border: 2px solid var(--primary);
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-dark bg-dark px-3 flex-nowrap">
        <span class="navbar-brand h1 mb-0 me-2 text-truncate"><i class="fas fa-layer-group me-2"></i>Studio</span>

        <!-- GESTION PROJET -->
        <div class="d-flex align-items-center gap-2 bg-secondary bg-opacity-10 p-1 rounded me-auto"
            style="border:1px solid #555;">
            <select id="projectSelect" class="form-select form-select-sm" style="width: 200px;"
                onchange="onProjectSelectChange()">
                <option value="" disabled selected>-- Charger Projet --</option>
            </select>

            <input type="text" id="projectFolderName" class="form-control form-control-sm" placeholder="Nom DU PROJET"
                value="Projet1">

            <button class="btn btn-sm btn-outline-light" onclick="saveProjectToLocal()" title="Mettre en mémoire"><i
                    class="fas fa-save"></i></button>
            <button class="btn btn-sm btn-outline-warning" onclick="loadSelectedProject()"
                title="Charger depuis la mémoire"><i class="fas fa-folder-open"></i></button>
        </div>

        <!-- ACTIONS -->
        <div class="d-flex align-items-center gap-2 ms-2">
            <div class="vr mx-2 text-white"></div>
            <button class="btn btn-sm btn-success fw-bold" onclick="exportJSON()"><i class="fas fa-file-download"></i>
                TÉLÉCHARGER data.json</button>
            <button class="btn btn-sm btn-primary" onclick="viewFinalProject()"><i class="fas fa-play"></i> Voir
                Final</button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row h-100">
            <!-- GAUCHE : CONTROLES -->
            <div class="col-md-4 editor-panel">
                <div class="accordion accordion-flush" id="editorAccordion">
                    <!-- 1. Global Settings -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#globalSettings">
                                <i class="fas fa-sliders-h me-2"></i> Paramètres Globaux
                            </button>
                        </h2>
                        <div id="globalSettings" class="accordion-collapse collapse show"
                            data-bs-parent="#editorAccordion">
                            <div class="accordion-body">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Musique de fond</label>
                                    <input type="file" id="musicFile" class="form-control form-control-sm"
                                        accept="audio/*">
                                    <small class="text-muted d-block mt-1" id="musicFileName">Aucun fichier
                                        choisi</small>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Durée par défaut (ms)</label>
                                    <input type="number" class="form-control form-control-sm" id="defaultDuration"
                                        value="50000">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Slides List -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#slidesListPanel">
                                <i class="fas fa-images me-2"></i> Diapositives <span class="badge bg-primary ms-2"
                                    id="slideCount">0</span>
                            </button>
                        </h2>
                        <div id="slidesListPanel" class="accordion-collapse collapse show"
                            data-bs-parent="#editorAccordion">
                            <div class="accordion-body d-flex flex-column h-100">
                                <button class="btn btn-outline-primary w-100 mb-3" onclick="addNewSlide()"><i
                                        class="fas fa-plus"></i> Nouvelle Slide</button>
                                <div id="slidesList" class="list-group list-group-flush overflow-auto">
                                    <!-- Items injectés par JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DROITE : PREVIEW -->
            <div class="col-md-8 preview-panel">
                <div class="p-2 text-center bg-secondary text-white small">
                    <i class="fas fa-eye"></i> PRÉVISUALISATION EN TEMPS RÉEL
                </div>
                <div id="preview-container">
                    <div id="preview-slider" class="carousel slide h-100 w-100" data-bs-ride="false">
                        <div class="carousel-inner h-100" id="preview-inner"></div>

                        <button class="carousel-control-prev" type="button" data-bs-target="#preview-slider"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#preview-slider"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL D'EDITION -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Éditer la Slide</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editIndex">

                    <!-- Contenu -->
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <label class="form-label">Titre</label>
                            <small class="text-muted" id="titleSizeVal">2.5rem</small>
                        </div>
                        <div class="input-group input-group-sm mb-1">
                            <input type="text" class="form-control" id="inpTitle">
                            <input type="range" class="form-range" id="inpTitleSize" min="1" max="6" step="0.1"
                                value="2.5"
                                oninput="document.getElementById('titleSizeVal').innerText = this.value + 'rem'">
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <label class="form-label">Contenu</label>
                            <small class="text-muted" id="contentSizeVal">1.2rem</small>
                        </div>
                        <div class="input-group input-group-sm mb-1">
                            <textarea class="form-control" id="inpContent" rows="4"></textarea>
                            <div class="input-group-text flex-column pt-3" style="width: 50px;">
                                <i class="fas fa-font fa-sm mb-2"></i>
                                <input type="range" id="inpContentSize" min="0.8" max="3" step="0.1" value="1.2"
                                    style="writing-mode: bt-lr; -webkit-appearance: slider-vertical; appearance: slider-vertical; height: 80px;"
                                    oninput="document.getElementById('contentSizeVal').innerText = this.value + 'rem'">
                            </div>
                        </div>
                    </div>

                    <hr>
                    <!-- Layout -->
                    <h6>Mise en page & Image</h6>
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Structure</label>
                            <select class="form-select" id="inpLayout" onchange="toggleImageField()">
                                <option value="left">Texte Gauche / Image Droite</option>
                                <option value="right">Texte Droite / Image Gauche</option>
                                <option value="none">Texte Uniquement (Pas d'image)</option>
                            </select>
                        </div>
                        <div class="col-md-6" id="imgInputGroup">
                            <label class="form-label">Image</label>
                            <input type="file" class="form-control form-control-sm" id="inpImage" accept="image/*">
                            <small class="text-muted" id="currentImageName">Pas de fichier</small>
                        </div>
                    </div>

                    <!-- Styles -->
                    <h6>Couleurs & Style</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Couleur de fond</label>
                            <div class="input-group">
                                <input type="color" class="form-control form-control-color" id="inpBgColor"
                                    value="#ffffff" title="Choisir la couleur">
                                <input type="text" class="form-control" id="inpBgColorText" value="#ffffff" readonly>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Couleur du Texte</label>
                            <div class="input-group">
                                <input type="color" class="form-control form-control-color" id="inpTextColor"
                                    value="#000000" title="Choisir la couleur">
                                <input type="text" class="form-control" id="inpTextColorText" value="#000000" readonly>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Alignement Titre</label>
                            <select class="form-select" id="inpTitleAlign">
                                <option value="flex-start">Gauche</option>
                                <option value="center">Centre</option>
                                <option value="flex-end">Droite</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Alignement Paragraphe</label>
                            <select class="form-select" id="inpContentAlign">
                                <option value="left">Gauche</option>
                                <option value="center">Centre</option>
                                <option value="right">Droite</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary" onclick="saveSlide()">Appliquer les
                        changements</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL D'EXPORT SUCCESS -->
    <div class="modal fade" id="exportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-check-circle me-2"></i> Export Réussi !</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="exportModalBody">
                    <!-- Rempli par JS -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">J'ai compris</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let currentProject = {
            settings: {
                musicPath: "assets/musics/file.mp3",
                defaultDuration: 50000
            },
            slides: []
        };

        let previewCarousel = null;
        let editModal = null;
        let exportModal = null;

        document.addEventListener('DOMContentLoaded', () => {
            editModal = new bootstrap.Modal(document.getElementById('editModal'));
            exportModal = new bootstrap.Modal(document.getElementById('exportModal'));
            initListeners();
            updateProjectListDropdown();
            renderPreview();
            renderSlideList();
        });

        function initListeners() {
            syncColorInputs('inpBgColor', 'inpBgColorText');
            syncColorInputs('inpTextColor', 'inpTextColorText');

            document.getElementById('musicFile').addEventListener('change', function () {
                if (this.files && this.files[0]) {
                    currentProject.settings.musicPath = this.files[0].name;
                    document.getElementById('musicFileName').innerText = this.files[0].name;
                }
            });
        }

        function syncColorInputs(colorId, textId) {
            const cInp = document.getElementById(colorId);
            const tInp = document.getElementById(textId);
            cInp.addEventListener('input', () => tInp.value = cInp.value);
        }

        function updateProjectListDropdown() {
            const select = document.getElementById('projectSelect');
            const prefix = 'preso_project_';
            select.innerHTML = '<option value="" disabled selected>-- Charger Projet --</option>';
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(prefix)) {
                    const projectName = key.replace(prefix, '');
                    const option = document.createElement('option');
                    option.value = projectName;
                    option.textContent = projectName;
                    select.appendChild(option);
                }
            }
        }

        function onProjectSelectChange() {
            const select = document.getElementById('projectSelect');
            const name = select.value;
            if (name) {
                document.getElementById('projectFolderName').value = name;
                loadProjectFromLocal(name);
            } else {
                document.getElementById('projectFolderName').value = "";
            }
        }

        function saveProjectToLocal() {
            const nameInput = document.getElementById('projectFolderName');
            const name = nameInput.value.trim();
            if (!name) { alert("Entrez un nom de projet."); return; }

            const saveData = JSON.parse(JSON.stringify(currentProject, (key, value) => {
                if (key === 'imageFile') return undefined;
                return value;
            }));

            localStorage.setItem('preso_project_' + name, JSON.stringify(saveData));
            updateProjectListDropdown();
            document.getElementById('projectSelect').value = name;
            alert("Projet '" + name + "' sauvegardé en mémoire locale.");
        }

        function loadSelectedProject() {
            const select = document.getElementById('projectSelect');
            const name = select.value;
            if (!name) { alert("Sélectionnez un projet."); return; }
            loadProjectFromLocal(name);
        }

        function loadProjectFromLocal(name) {
            const dataStr = localStorage.getItem('preso_project_' + name);
            if (dataStr) {
                currentProject = JSON.parse(dataStr);
                document.getElementById('projectFolderName').value = name;
                document.getElementById('defaultDuration').value = currentProject.settings.defaultDuration;
                document.getElementById('musicFileName').innerText = currentProject.settings.musicPath;
                renderSlideList();
                renderPreview();
            } else { alert("Erreur: Projet introuvable."); }
        }

        function exportJSON() {
            const projectName = document.getElementById('projectFolderName').value.trim();
            if (!projectName) { alert("Veuillez entrer un nom de projet."); return; }
            if (currentProject.slides.length === 0) { alert("Votre projet est vide !"); return; }

            const exportData = JSON.parse(JSON.stringify(currentProject, (key, value) => {
                if (key === 'imageFile') return undefined;
                return value;
            }));

            if (exportData.settings.musicPath) {
                const fileName = exportData.settings.musicPath.split('/').pop().split('\\').pop();
                exportData.settings.musicPath = `assets/${projectName}/music/${fileName}`;
            }

            exportData.slides.forEach(slide => {
                if (slide.imagePath) {
                    const fileName = slide.imagePath.split('/').pop().split('\\').pop();
                    slide.imagePath = `assets/${projectName}/images/${fileName}`;
                }
            });

            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportData, null, 4));
            const dlAnchorElem = document.createElement('a');
            dlAnchorElem.setAttribute("href", dataStr);
            dlAnchorElem.setAttribute("download", "data.json");
            document.body.appendChild(dlAnchorElem);
            dlAnchorElem.click();
            dlAnchorElem.remove();

            const instructions = `
                <p class="mb-3">Le fichier <b>data.json</b> a été téléchargé. Pour que les images et le son fonctionnent :</p>
                <div class="alert alert-info py-2">
                    <ol class="small mb-0">
                        <li>Déplacez <b>data.json</b> à côté de <code>index.html</code>.</li>
                        <li>Dans votre dossier <b>assets/</b>, créez cette structure :
                            <ul class="mt-1">
                                <li><code>${projectName}/images/</code></li>
                                <li><code>${projectName}/music/</code></li>
                            </ul>
                        </li>
                        <li><b>COPIEZ MANUELLEMENT</b> vos fichiers d'origine dans ces dossiers.</li>
                    </ol>
                </div>
                <p class="small text-danger mb-0">
                    <i class="fas fa-exclamation-triangle me-1"></i> <strong>Rappel :</strong> Le navigateur ne peut pas enregistrer vos fichiers directement sur votre disque pour des raisons de sécurité.
                </p>
            `;

            document.getElementById('exportModalBody').innerHTML = instructions;
            exportModal.show();
        }

        function addNewSlide() {
            const newSlide = {
                title: "Nouvelle Slide",
                content: "Votre texte ici...",
                layout: "left",
                imagePath: null,
                imageFile: null,
                bgColor: "#ffffff",
                textColor: "#000000",
                titleAlign: "center",
                contentAlign: "center",
                titleSize: "2.5rem",
                contentSize: "1.2rem",
                duration: 50000
            };
            currentProject.slides.push(newSlide);
            renderSlideList();
            renderPreview();
            openEditModal(currentProject.slides.length - 1);
        }

        function deleteSlide(index, e) {
            e.stopPropagation();
            if (confirm("Supprimer cette slide ?")) {
                currentProject.slides.splice(index, 1);
                renderSlideList();
                renderPreview();
            }
        }

        function renderSlideList() {
            const list = document.getElementById('slidesList');
            document.getElementById('slideCount').innerText = currentProject.slides.length;
            list.innerHTML = '';

            currentProject.slides.forEach((slide, i) => {
                const div = document.createElement('div');
                div.className = `list-group-item slide-item`;
                div.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <span><strong>${i + 1}.</strong> ${slide.title}</span>
                        <i class="fas fa-trash text-danger btn-float-del" title="Supprimer"></i>
                    </div>
                `;
                div.onclick = (e) => {
                    if (e.target.classList.contains('btn-float-del')) return;
                    openEditModal(i);
                };
                div.querySelector('.btn-float-del').onclick = (e) => deleteSlide(i, e);
                list.appendChild(div);
            });
        }

        function openEditModal(index) {
            const slide = currentProject.slides[index];
            document.getElementById('editIndex').value = index;

            document.getElementById('inpTitle').value = slide.title;
            document.getElementById('inpContent').value = slide.content;
            document.getElementById('inpTitleSize').value = parseFloat(slide.titleSize);
            document.getElementById('titleSizeVal').innerText = slide.titleSize;
            document.getElementById('inpContentSize').value = parseFloat(slide.contentSize);
            document.getElementById('contentSizeVal').innerText = slide.contentSize;

            document.getElementById('inpLayout').value = slide.layout || 'left';
            document.getElementById('currentImageName').innerText = slide.imagePath ? slide.imagePath : "Pas de fichier";
            document.getElementById('inpImage').value = "";

            document.getElementById('inpBgColor').value = slide.bgColor;
            document.getElementById('inpBgColorText').value = slide.bgColor;
            document.getElementById('inpTextColor').value = slide.textColor;
            document.getElementById('inpTextColorText').value = slide.textColor;

            document.getElementById('inpTitleAlign').value = slide.titleAlign;
            document.getElementById('inpContentAlign').value = slide.contentAlign;

            toggleImageField();
            editModal.show();
        }

        function toggleImageField() {
            const layout = document.getElementById('inpLayout').value;
            const imgGroup = document.getElementById('imgInputGroup');
            if (layout === 'none') {
                imgGroup.style.display = 'none';
            } else {
                imgGroup.style.display = 'block';
            }
        }

        function saveSlide() {
            const idx = parseInt(document.getElementById('editIndex').value);
            const slide = currentProject.slides[idx];

            slide.title = document.getElementById('inpTitle').value;
            slide.content = document.getElementById('inpContent').value;
            slide.titleSize = document.getElementById('inpTitleSize').value + 'rem';
            slide.contentSize = document.getElementById('inpContentSize').value + 'rem';
            slide.layout = document.getElementById('inpLayout').value;
            slide.bgColor = document.getElementById('inpBgColor').value;
            slide.textColor = document.getElementById('inpTextColor').value;
            slide.titleAlign = document.getElementById('inpTitleAlign').value;
            slide.contentAlign = document.getElementById('inpContentAlign').value;

            const fileInput = document.getElementById('inpImage');
            if (fileInput.files && fileInput.files[0]) {
                slide.imageFile = fileInput.files[0];
                slide.imagePath = fileInput.files[0].name;
            } else if (slide.layout !== 'none' && !slide.imagePath && !slide.imageFile) {
                slide.imagePath = "assets/images/default.jpg";
            }

            if (slide.layout === 'none') {
                slide.imagePath = null;
                slide.imageFile = null;
            }

            renderSlideList();
            renderPreview();
            editModal.hide();
        }

        function renderPreview() {
            const container = document.getElementById('preview-inner');
            container.innerHTML = '';
            const slides = currentProject.slides;

            if (slides.length === 0) {
                container.innerHTML = '<div class="h-100 d-flex align-items-center justify-content-center text-muted">Aucune slide.</div>';
                return;
            }

            slides.forEach((slide, i) => {
                const item = document.createElement('div');
                item.className = `carousel-item h-100 ${i === 0 ? 'active' : ''}`;

                const wrapper = document.createElement('div');
                wrapper.style.display = 'flex';
                wrapper.style.width = '100%';
                wrapper.style.height = '100%';

                const textCol = document.createElement('div');
                textCol.style.display = 'flex';
                textCol.style.flexDirection = 'column';
                textCol.style.justifyContent = 'center';
                textCol.style.alignItems = slide.titleAlign || 'flex-start';
                textCol.style.padding = '4rem';
                textCol.style.backgroundColor = slide.bgColor || '#fff';
                textCol.style.color = slide.textColor || '#000';
                textCol.style.textAlign = slide.contentAlign || 'left';
                textCol.style.width = '100%';

                const paragraphs = slide.content.split('\n').filter(p => p.trim() !== '').map(p => `<p style="margin-bottom:1rem; font-size:${slide.contentSize}; line-height:1.6;">${p}</p>`).join('');
                textCol.innerHTML = `
                    <h1 style="font-weight:800; margin-bottom:1.5rem; color:${slide.textColor}; font-size:${slide.titleSize}">${slide.title}</h1>
                    <div>${paragraphs}</div>
                `;

                let imageCol = null;
                if (slide.layout !== 'none' && (slide.imageFile || slide.imagePath)) {
                    imageCol = document.createElement('div');
                    imageCol.style.position = 'relative';
                    imageCol.style.overflow = 'hidden';
                    imageCol.style.width = '50%';
                    imageCol.style.height = '100%';
                    imageCol.style.backgroundColor = '#000';

                    const img = document.createElement('img');
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    img.style.position = 'absolute';

                    if (slide.imageFile) {
                        img.src = URL.createObjectURL(slide.imageFile);
                    } else if (slide.imagePath) {
                        const projectName = document.getElementById('projectFolderName').value.trim();
                        if (!slide.imagePath.includes('/')) {
                            img.src = `assets/${projectName}/images/${slide.imagePath}`;
                        } else {
                            img.src = slide.imagePath;
                        }
                    }

                    img.onerror = () => {
                        img.style.display = 'none';
                        imageCol.style.backgroundColor = '#333';
                    };

                    imageCol.appendChild(img);
                    textCol.style.width = '50%';
                }

                if (slide.layout === 'right' && imageCol) {
                    wrapper.appendChild(imageCol);
                    wrapper.appendChild(textCol);
                } else {
                    wrapper.appendChild(textCol);
                    if (imageCol) wrapper.appendChild(imageCol);
                }

                item.appendChild(wrapper);
                container.appendChild(item);
            });

            const sliderEl = document.getElementById('preview-slider');
            if (previewCarousel) previewCarousel.dispose();
            previewCarousel = new bootstrap.Carousel(sliderEl, { interval: false });
        }

        function viewFinalProject() {
            if (currentProject.slides.length === 0) { alert("Projet vide."); return; }
            window.open('index.html', '_blank');
        }
    </script>
</body>

</html>